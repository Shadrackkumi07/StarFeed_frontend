{"ast":null,"code":"var _jsxFileName = \"D:\\\\CoSchedule\\\\coschedule_frontend\\\\src\\\\components\\\\Rating.jsx\",\n  _s = $RefreshSig$();\n// src/components/Rating.jsx\nimport React, { useState, useEffect } from 'react';\nimport { FaStar } from 'react-icons/fa';\nimport api from '../api';\nimport { useAuth } from '../auth/AuthProvider';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Rating({\n  itemId\n}) {\n  _s();\n  const {\n    currentUser\n  } = useAuth();\n  const [ratings, setRatings] = useState([]); // all ratings\n  const [userRating, setUserRating] = useState(0); // value (1–5)\n  const [userRatingId, setUserRatingId] = useState(null); // Mongo _id for DELETE\n  const [hover, setHover] = useState(0);\n  const [loading, setLoading] = useState(true);\n\n  // Fetch ratings and identify this user’s\n  useEffect(() => {\n    const fetchRatings = async () => {\n      try {\n        const resp = await api.get('/ratings', {\n          params: {\n            itemId\n          }\n        });\n        const all = resp.data;\n        setRatings(all);\n        const mine = all.find(r => r.userId === currentUser.uid);\n        if (mine) {\n          setUserRating(mine.value);\n          setUserRatingId(mine._id);\n        } else {\n          setUserRating(0);\n          setUserRatingId(null);\n        }\n      } catch (err) {\n        console.error('Could not load ratings', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchRatings();\n  }, [itemId, currentUser.uid]);\n\n  // Compute average\n  const avg = ratings.length ? (ratings.reduce((sum, r) => sum + r.value, 0) / ratings.length).toFixed(1) : '—';\n\n  // Click handler: upsert or delete\n  const handleClick = async value => {\n    try {\n      const token = await currentUser.getIdToken();\n      if (value === userRating && userRatingId) {\n        // Delete existing rating\n        await api.delete(`/ratings/${userRatingId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n      } else {\n        // Create/update (upsert) rating\n        const resp = await api.post('/ratings', {\n          itemId,\n          value\n        }, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        setUserRatingId(resp.data._id);\n      }\n\n      // Refresh all ratings\n      const refresh = await api.get('/ratings', {\n        params: {\n          itemId\n        }\n      });\n      const all = refresh.data;\n      setRatings(all);\n      const mine = all.find(r => r.userId === currentUser.uid);\n      setUserRating((mine === null || mine === void 0 ? void 0 : mine.value) || 0);\n      setUserRatingId((mine === null || mine === void 0 ? void 0 : mine._id) || null);\n    } catch (err) {\n      console.error('Error updating rating', err);\n    }\n  };\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading rating\\u2026\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 23\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex items-center space-x-2 text-sm\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex\",\n      children: [1, 2, 3, 4, 5].map(star => /*#__PURE__*/_jsxDEV(FaStar, {\n        size: 20,\n        className: \"cursor-pointer\",\n        color: hover >= star ? '#ffd700' : !hover && userRating >= star ? '#ffc107' : '#e4e5e9',\n        onMouseEnter: () => setHover(star),\n        onMouseLeave: () => setHover(0),\n        onClick: () => handleClick(star)\n      }, star, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Avg: \", avg, \" \", ratings.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [\"(\", ratings.length, \")\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 43\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n}\n_s(Rating, \"K9iVEfaCI/vzjTKDzlBZVSp/b/o=\", false, function () {\n  return [useAuth];\n});\n_c = Rating;\nvar _c;\n$RefreshReg$(_c, \"Rating\");","map":{"version":3,"names":["React","useState","useEffect","FaStar","api","useAuth","jsxDEV","_jsxDEV","Rating","itemId","_s","currentUser","ratings","setRatings","userRating","setUserRating","userRatingId","setUserRatingId","hover","setHover","loading","setLoading","fetchRatings","resp","get","params","all","data","mine","find","r","userId","uid","value","_id","err","console","error","avg","length","reduce","sum","toFixed","handleClick","token","getIdToken","delete","headers","Authorization","post","refresh","children","fileName","_jsxFileName","lineNumber","columnNumber","className","map","star","size","color","onMouseEnter","onMouseLeave","onClick","_c","$RefreshReg$"],"sources":["D:/CoSchedule/coschedule_frontend/src/components/Rating.jsx"],"sourcesContent":["// src/components/Rating.jsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport { FaStar } from 'react-icons/fa';\r\nimport api from '../api';\r\nimport { useAuth } from '../auth/AuthProvider';\r\n\r\nexport default function Rating({ itemId }) {\r\n  const { currentUser } = useAuth();\r\n  const [ratings, setRatings]           = useState([]);    // all ratings\r\n  const [userRating, setUserRating]     = useState(0);     // value (1–5)\r\n  const [userRatingId, setUserRatingId] = useState(null);  // Mongo _id for DELETE\r\n  const [hover, setHover]               = useState(0);\r\n  const [loading, setLoading]           = useState(true);\r\n\r\n  // Fetch ratings and identify this user’s\r\n  useEffect(() => {\r\n    const fetchRatings = async () => {\r\n      try {\r\n        const resp = await api.get('/ratings', { params: { itemId } });\r\n        const all = resp.data;\r\n        setRatings(all);\r\n\r\n        const mine = all.find(r => r.userId === currentUser.uid);\r\n        if (mine) {\r\n          setUserRating(mine.value);\r\n          setUserRatingId(mine._id);\r\n        } else {\r\n          setUserRating(0);\r\n          setUserRatingId(null);\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error('Could not load ratings', err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchRatings();\r\n  }, [itemId, currentUser.uid]);\r\n\r\n  // Compute average\r\n  const avg = ratings.length\r\n    ? (ratings.reduce((sum, r) => sum + r.value, 0) / ratings.length).toFixed(1)\r\n    : '—';\r\n\r\n  // Click handler: upsert or delete\r\n  const handleClick = async (value) => {\r\n    try {\r\n      const token = await currentUser.getIdToken();\r\n\r\n      if (value === userRating && userRatingId) {\r\n        // Delete existing rating\r\n        await api.delete(`/ratings/${userRatingId}`, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n      } else {\r\n        // Create/update (upsert) rating\r\n        const resp = await api.post('/ratings', { itemId, value }, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        setUserRatingId(resp.data._id);\r\n      }\r\n\r\n      // Refresh all ratings\r\n      const refresh = await api.get('/ratings', {\r\n        params: { itemId }\r\n      });\r\n      const all = refresh.data;\r\n      setRatings(all);\r\n      const mine = all.find(r => r.userId === currentUser.uid);\r\n      setUserRating(mine?.value || 0);\r\n      setUserRatingId(mine?._id || null);\r\n\r\n    } catch (err) {\r\n      console.error('Error updating rating', err);\r\n    }\r\n  };\r\n\r\n  if (loading) return <p>Loading rating…</p>;\r\n\r\n  return (\r\n    <div className=\"flex items-center space-x-2 text-sm\">\r\n      <div className=\"flex\">\r\n        {[1,2,3,4,5].map(star => (\r\n          <FaStar\r\n            key={star}\r\n            size={20}\r\n            className=\"cursor-pointer\"\r\n            color={\r\n              hover >= star\r\n                ? '#ffd700'\r\n                : (!hover && userRating >= star)\r\n                  ? '#ffc107'\r\n                  : '#e4e5e9'\r\n            }\r\n            onMouseEnter={() => setHover(star)}\r\n            onMouseLeave={() => setHover(0)}\r\n            onClick={() => handleClick(star)}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div>\r\n        Avg: {avg} {ratings.length > 0 && <span>({ratings.length})</span>}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}