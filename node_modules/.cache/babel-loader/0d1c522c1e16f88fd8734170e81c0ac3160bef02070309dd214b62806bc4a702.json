{"ast":null,"code":"// src/components/Rating.jsx\nimport React,{useState,useEffect}from'react';import{FaStar}from'react-icons/fa';import api from'../api';import{useAuth}from'../auth/AuthProvider';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Rating(_ref){let{itemId}=_ref;const{currentUser}=useAuth();const[ratings,setRatings]=useState([]);// all ratings\nconst[userRating,setUserRating]=useState(0);// value (1–5)\nconst[userRatingId,setUserRatingId]=useState(null);// Mongo _id for DELETE\nconst[hover,setHover]=useState(0);const[loading,setLoading]=useState(true);// Fetch ratings and identify this user’s\nuseEffect(()=>{const fetchRatings=async()=>{try{const resp=await api.get('/ratings',{params:{itemId}});const all=resp.data;setRatings(all);const mine=all.find(r=>r.userId===currentUser.uid);if(mine){setUserRating(mine.value);setUserRatingId(mine._id);}else{setUserRating(0);setUserRatingId(null);}}catch(err){console.error('Could not load ratings',err);}finally{setLoading(false);}};fetchRatings();},[itemId,currentUser.uid]);// Compute average\nconst avg=ratings.length?(ratings.reduce((sum,r)=>sum+r.value,0)/ratings.length).toFixed(1):'—';// Click handler: upsert or delete\nconst handleClick=async value=>{try{const token=await currentUser.getIdToken();if(value===userRating&&userRatingId){// Delete existing rating\nawait api.delete(`/ratings/${userRatingId}`,{headers:{Authorization:`Bearer ${token}`}});}else{// Create/update (upsert) rating\nconst resp=await api.post('/ratings',{itemId,value},{headers:{Authorization:`Bearer ${token}`}});setUserRatingId(resp.data._id);}// Refresh all ratings\nconst refresh=await api.get('/ratings',{params:{itemId}});const all=refresh.data;setRatings(all);const mine=all.find(r=>r.userId===currentUser.uid);setUserRating((mine===null||mine===void 0?void 0:mine.value)||0);setUserRatingId((mine===null||mine===void 0?void 0:mine._id)||null);}catch(err){console.error('Error updating rating',err);}};if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Loading rating\\u2026\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:[1,2,3,4,5].map(star=>/*#__PURE__*/_jsx(FaStar,{size:20,className:\"cursor-pointer\",color:hover>=star?'#ffd700':!hover&&userRating>=star?'#ffc107':'#e4e5e9',onMouseEnter:()=>setHover(star),onMouseLeave:()=>setHover(0),onClick:()=>handleClick(star)},star))}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Avg: \",avg,\" \",ratings.length>0&&/*#__PURE__*/_jsxs(\"span\",{children:[\"(\",ratings.length,\" \",ratings.length===1?\"review\":\"reviews\",\")\"]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","FaStar","api","useAuth","jsx","_jsx","jsxs","_jsxs","Rating","_ref","itemId","currentUser","ratings","setRatings","userRating","setUserRating","userRatingId","setUserRatingId","hover","setHover","loading","setLoading","fetchRatings","resp","get","params","all","data","mine","find","r","userId","uid","value","_id","err","console","error","avg","length","reduce","sum","toFixed","handleClick","token","getIdToken","delete","headers","Authorization","post","refresh","children","className","map","star","size","color","onMouseEnter","onMouseLeave","onClick"],"sources":["D:/CoSchedule/coschedule_frontend/src/components/Rating.jsx"],"sourcesContent":["// src/components/Rating.jsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport { FaStar } from 'react-icons/fa';\r\nimport api from '../api';\r\nimport { useAuth } from '../auth/AuthProvider';\r\n\r\nexport default function Rating({ itemId }) {\r\n  const { currentUser } = useAuth();\r\n  const [ratings, setRatings]           = useState([]);    // all ratings\r\n  const [userRating, setUserRating]     = useState(0);     // value (1–5)\r\n  const [userRatingId, setUserRatingId] = useState(null);  // Mongo _id for DELETE\r\n  const [hover, setHover]               = useState(0);\r\n  const [loading, setLoading]           = useState(true);\r\n\r\n  // Fetch ratings and identify this user’s\r\n  useEffect(() => {\r\n    const fetchRatings = async () => {\r\n      try {\r\n        const resp = await api.get('/ratings', { params: { itemId } });\r\n        const all = resp.data;\r\n        setRatings(all);\r\n\r\n        const mine = all.find(r => r.userId === currentUser.uid);\r\n        if (mine) {\r\n          setUserRating(mine.value);\r\n          setUserRatingId(mine._id);\r\n        } else {\r\n          setUserRating(0);\r\n          setUserRatingId(null);\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error('Could not load ratings', err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchRatings();\r\n  }, [itemId, currentUser.uid]);\r\n\r\n  // Compute average\r\n  const avg = ratings.length\r\n    ? (ratings.reduce((sum, r) => sum + r.value, 0) / ratings.length).toFixed(1)\r\n    : '—';\r\n\r\n  // Click handler: upsert or delete\r\n  const handleClick = async (value) => {\r\n    try {\r\n      const token = await currentUser.getIdToken();\r\n\r\n      if (value === userRating && userRatingId) {\r\n        // Delete existing rating\r\n        await api.delete(`/ratings/${userRatingId}`, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n      } else {\r\n        // Create/update (upsert) rating\r\n        const resp = await api.post('/ratings', { itemId, value }, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        setUserRatingId(resp.data._id);\r\n      }\r\n\r\n      // Refresh all ratings\r\n      const refresh = await api.get('/ratings', {\r\n        params: { itemId }\r\n      });\r\n      const all = refresh.data;\r\n      setRatings(all);\r\n      const mine = all.find(r => r.userId === currentUser.uid);\r\n      setUserRating(mine?.value || 0);\r\n      setUserRatingId(mine?._id || null);\r\n\r\n    } catch (err) {\r\n      console.error('Error updating rating', err);\r\n    }\r\n  };\r\n\r\n  if (loading) return <p>Loading rating…</p>;\r\n\r\n  return (\r\n    <div className=\"flex items-center space-x-2 text-sm\">\r\n      <div className=\"flex\">\r\n        {[1,2,3,4,5].map(star => (\r\n          <FaStar\r\n            key={star}\r\n            size={20}\r\n            className=\"cursor-pointer\"\r\n            color={\r\n              hover >= star\r\n                ? '#ffd700'\r\n                : (!hover && userRating >= star)\r\n                  ? '#ffc107'\r\n                  : '#e4e5e9'\r\n            }\r\n            onMouseEnter={() => setHover(star)}\r\n            onMouseLeave={() => setHover(0)}\r\n            onClick={() => handleClick(star)}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div>\r\n  Avg: {avg}{\" \"}\r\n  {ratings.length > 0 && (\r\n    <span>\r\n      ({ratings.length} {ratings.length === 1 ? \"review\" : \"reviews\"})\r\n    </span>\r\n  )}\r\n</div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}